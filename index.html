<!DOCTYPE html>
<html class="dark" lang="nl-NL">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VVS Rotselaar Drankkaart</title>
  <link rel="icon" type="image/png" href="VVS-Logo.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 15px 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 100%;
      overflow-x: hidden;
      box-sizing: border-box;
      background: #fff;
    }

    #drank-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px 10px;
      margin-top: 10px;
      justify-items: center;
      width: 100%;
      max-width: 600px;
    }

    #reset-knop {
      padding: 6px 12px;
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      margin-left: auto;
    }

    #reset-knop:hover {
      background-color: #d32f2f;
    }

    .drank {
      cursor: pointer;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      min-height: 110px;
      border-radius: 12px;
      transition: background-color 0.2s;
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 12px;
      justify-content: center;
      padding: 10px;
      max-width: 100%;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .drank img {
      width: 18vw;
      max-width: 80px;
      height: auto;
      aspect-ratio: 1 / 1;
      border-radius: 10px;
      transition: transform 0.2s;
      display: block;
      margin: 0 auto 4px;
    }

    .drank img:hover {
      transform: scale(1.1);
    }

    .drank:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .drank p {
      margin: 0;
      font-size: 0.9em;
      line-height: 1.1em;
      text-align: center;
    }

    .prijs {
      font-size: 1.3em;
      margin-top: 8px;
    }

    .overzicht {
      margin-top: 8px;
      font-size: 1em;
      max-width: 600px;
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .overzicht-item {
      margin-bottom: 8px;
      width: 80%;
      max-width: 300px;
      background: #f0f0f0;
      padding: 6px 10px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .knoppen {
      display: flex;
      gap: 6px;
    }
    
    .knop {
      width: 26px;
      height: 26px;
      font-size: 1em;
      line-height: 22px;
      text-align: center;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
      user-select: none;
    }

    .plus { background: #5cb85c; }
    .plus:hover { background: #4cae4c; }

    .min { background: #f0ad4e; }
    .min:hover { background: #ec971f; }

    .delete { background: #d9534f; }
    .delete:hover { background: #c9302c; }

    .header {
      position: relative; /* nodig voor absolute positioning */
      display: flex;
      align-items: center;
      justify-content: space-between; /* logo links, knop rechts */
      width: 100%;
      max-width: 600px;
      padding: 0 10px;
      margin-bottom: 6px;
      box-sizing: border-box;
      color: white;
      background-color: #092d7e;
      height: 50px;
      border-radius: 4px;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 30px;
    }

    .header h1 {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      margin: 0;
      font-size: 1.6em;
      text-align: center;
      width: max-content;
    }

    @media (max-width: 400px) {
      .header h1 {
        font-size: 1.3em;
      }

      .drank p {
        font-size: 0.8em;
      }

      .knop {
        width: 24px;
        height: 24px;
        font-size: 0.9em;
      }

      .logo {
        width: 32px;
        height: 32px;
      }
    }

    #submit-knop {
      margin-top: 12px;
      background: #092d7e;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      padding: 8px 16px;
      cursor: pointer;
    }
    .onderaan {
      margin-top: 12px;
      background: #092d7e;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      padding: 8px 16px;
      cursor: pointer;
      width: 220px;
    }

    #submit-knop:hover {
      background-color: #061f5c;
    }

    #status-icon {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4caf50; /* groen */
      color: white;
      font-size: 24px;
      padding: 10px 14px;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: none; /* standaard verborgen */
      z-index: 9999;
    }

    #check-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: white;
      border-radius: 50%;
      width: 120px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      opacity: 0;
      pointer-events: none;
      z-index: 10000;
    }

    #check-popup.show {
      animation: popupFade 1s ease forwards;
    }

    @keyframes popupFade {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      40% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
      }
      70% {
        transform: translate(-50%, -50%) scale(0.9);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

/* âœ… Het groene check-icoon */
    #check-popup svg {
      width: 70px;
      height: 70px;
      stroke: #4caf50;
      stroke-width: 6;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 100;
      stroke-dashoffset: 100;
      animation: drawCheck 0.8s ease forwards 0.3s;
    }

    @keyframes drawCheck {
      to {
        stroke-dashoffset: 0;
      }
    }

    #login-button:disabled {
      background-color: #e1e1e1; /* bijvoorbeeld wit om bij het gif te passen */
      color: transparent; /* zodat de tekst niet zichtbaar is */
      cursor: not-allowed;
      border:none;
      border-radius:6px;
    }

    #qr-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7); /* donker transparant */
      display: none; /* standaard verborgen */
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    /* Box in het midden */
    #qr-box {
      background: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    /* Sluit-knop rechtsboven */
    #close-qr {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #333;
    }

    #qrcode {
      margin-top: 5px;
    }

    #login-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: #092d7e;
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      font-size: 1.2em;
      opacity: 0;
      pointer-events: none;
      text-align: center;
      z-index: 10000;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    #login-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #login-overlay h2 {
      color: white;
      margin-bottom: 20px;
    }

    /* Input velden */
    #login-overlay div {
      position: relative;
      width: 220px;
      margin-bottom: 12px;
    }

    #manager-iframe-container {
      display: none; /* standaard verborgen */
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 10000; /* boven alles */
      overflow: hidden;
    }

    #manager-iframe {
      width: 100%;
      height: 100%;
      border: none;
      overflow: auto;
    }

    #close-iframe {
      position: absolute;
      top: 8px;
      left: 8px;
      padding: 8px 12px;
      font-size: 1em;
      cursor: pointer;
      background: #092d7e;
      color: white;
      border: none;
      border-radius: 6px;
      z-index: 10001; /* boven iframe */
    }

    #close-iframe:hover {
        background: #061c4e;
    }

    #refresh-iframe {
      position: absolute;
      top: 48px;
      left: 8px;
      padding: 8px 12px;
      font-size: 1em;
      cursor: pointer;
      background: #5cb85c;
      color: white;
      border: none;
      border-radius: 6px;
      z-index: 10001;
    }

    #refresh-iframe:hover {
        background: #448844;
    }

    #scrolldown-iframe {
      position: absolute;
      top: 88px;
      left: 8px;
      padding: 8px 12px;
      font-size: 1em;
      cursor: pointer;
      background: #5cb85c;
      color: white;
      border: none;
      border-radius: 6px;
      z-index: 10001;
    }

    #scrolldown-iframe:hover {
        background: #448844;
    }

    #cash-overlay,
    #kaart-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    #cash-box,
    #kaart-box {
      position: relative; /* ðŸ”‘ nodig zodat het kruisje zich hierbinnen positioneert */
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    #close-cash,
    #close-kaart {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #555;
      line-height: 1;
    }

    #geld-knoppen button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    #geld-knoppen button:hover {
      background: #0056b3;
    }

    #terminaloptions button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    #terminaloptions button:hover {
      background: #0056b3;
    }

    #cash-betaald,
    #qr-betaald {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 18px;
      background: green;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #cash-betaald:hover,
    #qr-betaald:hover {
      background: darkgreen;
    }
    #cash-overzicht {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column; /* zodat meerdere items netjes onder elkaar komen */
      margin-bottom: 15px; /* beetje ruimte onder het overzicht */
    }
    #cash-overzicht > div {
      width: 100%;
      text-align: center; /* tekst in het midden */
    }
  </style>
</head>
<body>
  <div id="manager-iframe-container">
    <iframe id="manager-iframe" src="https://docs.google.com/spreadsheets/d/1uLQZgqjY1DVUsFXg6mvUsg2LgLhO_DB5wTZ8L1vxkgg/preview" style="width:100%; height:100%; border:none;"></iframe>
    <button id="close-iframe">âœ–</button>
    <button id="refresh-iframe">â†º</button>
  </div>

  <div class="header">
    <img src="https://impro.usercontent.one/appid/oneComWsb/domain/vvsrotselaar.be/media/vvsrotselaar.be/onewebmedia/VVS-LOGO-zonderstitches-page-001-resized.jpg?etag=%2263d81-60844d92%22&sourceContentType=image%2Fjpeg&ignoreAspectRatio&resize=192%2B192&quality=85" alt="logo" class="logo">
    <h1>VVS Rotselaar</h1>
    <button id="reset-knop" onclick="resetAlles()">â†º Reset</button>
  </div>
  <p id="logged-in-user" style="text-align:center; margin:2px 0; color: rgb(153, 153, 153); font-size: x-small;"></p>

  <div id="login-popup">Welkom!</div>
  <div id="login-overlay">
    <h2 style="color:white;margin-bottom:20px;">Login Shift</h2>
    <!-- Username veld -->
    <div style="position: relative; width:220px; margin-bottom:12px;">
      <input type="text" id="username" placeholder="Gebruikersnaam" style="padding:6px; width:100%; box-sizing:border-box;">
    </div>
    <!-- Wachtwoord veld met oogje -->
    <div style="position: relative; width:220px; margin-bottom:12px;">
      <input type="password" id="password" placeholder="Wachtwoord" style="padding:6px 36px 6px 6px; width:100%; box-sizing:border-box;">
      <img id="togglePassword" src="https://cdn-icons-png.flaticon.com/512/2767/2767146.png"
        style="position:absolute; right:8px; top:50%; transform:translateY(-50%); width:24px; height:24px; cursor:pointer;">
    </div>
    <button id="login-button" onclick="login()" style="padding:6px 12px; width:220px;">Login</button>
    <p id="login-error" style="color:red;margin-top:6px;"></p>
  </div>

  <div id="bestel-scherm"></div>
    <div id="drank-container"></div>
    <div class="prijs" id="totaal">Totaal: â‚¬0,00</div>
    <div class="overzicht" id="overzicht"></div>
    <button id="kaart-knop" class="onderaan">ðŸ’³ Betalen met kaart</button>
    <button id="qr-knop" class="onderaan" onclick="toonQR(totaal)">ðŸ“± Betalen QR</button>
    <button id="cash-knop" class="onderaan" onclick="toonCash(totaal)">ðŸ’µ Cash betalen</button>
  </div>

  <div id="kaart-overlay">
    <div id="kaart-box">
      <span id="close-kaart">&times;</span>
      <h2 style="margin-bottom:10px;">Kies Betaalterminal</h2>
      <div id="terminaloptions">
        <button onclick="chooseTerminal(1)">1</button>
        <button onclick="chooseTerminal(2)">2</button>
        <button onclick="chooseTerminal(3)">3</button>
      </div>
    </div>
  </div>

  <div id="qr-overlay">
    <div id="qr-box">
      <span id="close-qr">&times;</span>
      <div style="display:flex; flex-direction:column; align-items:center;">
        <h2 style="margin-bottom:10px;">Scan om te betalen</h2>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
          <img src="https://www.payconiq.be/img/payconiq/logo-app-under-pink-v2.svg" alt="Payconiq" style="height:40px;">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bancontact_logo.svg/2560px-Bancontact_logo.svg.png" alt="Bancontact" style="height:40px;">
        </div>
        <p id="qr-bedrag" style="font-size:24px; font-weight:bold; margin-bottom:5px;">â‚¬0,00</p>
        <canvas id="qrcode"></canvas>
      </div>
      <button id="qr-betaald" onclick="afrondenQR()">âœ… Betaald</button>
    </div>
  </div>

  <div id="cash-overlay">
    <div id="cash-box">
      <span id="close-cash">&times;</span>
      <h2>Cash betaling</h2>
      <div id="cash-overzicht"></div>
      <p id="cash-totaal" style="font-weight:bold; font-size:20px;"></p>
      <div id="geld-knoppen">
        <button onclick="addCash(50)">â‚¬50</button>
        <button onclick="addCash(20)">â‚¬20</button>
        <button onclick="addCash(10)">â‚¬10</button>
        <button onclick="addCash(5)">â‚¬5</button>
        <button onclick="addCash(2)">â‚¬2</button>
        <button onclick="addCash(1)">â‚¬1</button>
        <button onclick="addCash(0.50)">â‚¬0,50</button>
        <button onclick="addCash(0.20)">â‚¬0,20</button>
        <button onclick="addCash(0.10)">â‚¬0,10</button>
        <button onclick="exactCash()">âœ”</button>
        <button onclick="resetCash()">âœ–</button>
      </div>

      <p id="ontvangen">Ontvangen: â‚¬0,00</p>
      <p id="terug">Terug te geven: â‚¬0,00</p>

      <button id="cash-betaald" onclick="afrondenCash()">âœ… Betaald</button>
    </div>
  </div>
  
  <div id="status-icon">âœ”</div>
  <div id="check-popup">
    <svg viewBox="0 0 52 52">
      <path d="M14 27 l7 7 l17 -17"></path>
    </svg>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
      let currentBarman = null;
      let currentRole = null;
      let paymentMethod = "onbekend";

      function login() {
        const usernameInput = document.getElementById("username").value.trim();
        const passwordInput = document.getElementById("password").value.trim();

        if (!usernameInput || !passwordInput) {
          document.getElementById("login-error").innerText = "Vul gebruikersnaam en wachtwoord in";
          return;
        }

        // âœ… Toon laadicoon
        const loginButton = document.getElementById("login-button");
          loginButton.disabled = true;
          loginButton.innerHTML = '<img src="https://i.giphy.com/6036p0cTnjUrNFpAlr.webp" alt="Loading..." style="height:32px;">';

        let form = new FormData();
        form.append("username", usernameInput);
        form.append("password", passwordInput);

        fetch("https://script.google.com/macros/s/AKfycbzzld0Hi60HAWNV3eVj0-TM7nlstyArbjS68oVstNtZK6XM7XKdZJO_yXLM_PK9fr8K/exec", {
          method: "POST",
          body: form
        })
        .then(res => res.json())
        .then(data => {
          loginButton.disabled = false;
          loginButton.innerHTML = "Login";
          if (data.status === "ok") {
            currentBarman = usernameInput.toUpperCase();
            currentRole = data.role;
            document.getElementById("login-overlay").style.display = "none";
            showLoginPopup("Welkom, " + currentBarman + "!");
            document.getElementById("logged-in-user").innerText = "Logged in as: " + currentBarman + " (" + currentRole.toUpperCase() + ")";
          } else {
            document.getElementById("login-error").innerText = "Ongeldige gebruikersnaam of wachtwoord";
          }
        })
        .catch(err => {
          console.error("Login error:", err);
          document.getElementById("login-error").innerText = "Er ging iets mis bij het verbinden.";
        });
      }

      const logo = document.querySelector(".logo");
      const bestelScherm = document.getElementById("bestel-scherm"); // container van je drankknoppen + knoppen
      const managerIframeContainer = document.getElementById("manager-iframe-container");
      const closeIframeBtn = document.getElementById("close-iframe");
      const refreshIframeBtn = document.getElementById("refresh-iframe");
      const managerIframe = document.getElementById("manager-iframe");

      // Klik op logo alleen als rol manager
      logo.addEventListener("click", () => {
        if (currentRole && currentRole.toLowerCase() === "manager") {
          bestelScherm.style.display = "none";
          managerIframeContainer.style.display = "block";
        }
      });

      // Sluit-knop iframe
      closeIframeBtn.addEventListener("click", () => {
        managerIframeContainer.style.display = "none";
        bestelScherm.style.display = "block";
      });
      refreshIframeBtn.addEventListener("click", () => {
        managerIframe.src = managerIframe.src;
      });

      // Popup bij succesvolle login
      function showLoginPopup(message) {
        const popup = document.getElementById("login-popup");
        popup.innerText = message;
        popup.style.opacity = "1";
        popup.style.pointerEvents = "auto";
        popup.style.transform = "translate(-50%, -50%) scale(1)";

        setTimeout(() => {
          popup.style.opacity = "0";
          popup.style.pointerEvents = "none";
          popup.style.transform = "translate(-50%, -50%) scale(0.8)";
        }, 2000);
      }

      // ðŸ‘ï¸ Toggle password visibility
      const togglePassword = document.getElementById("togglePassword");
      const passwordField = document.getElementById("password");

      const showIcon = "https://cdn-icons-png.flaticon.com/512/2767/2767146.png";
      const hideIcon = "https://cdn-icons-png.flaticon.com/512/2767/2767194.png";

      togglePassword.addEventListener("click", () => {
        const type = passwordField.getAttribute("type") === "password" ? "text" : "password";
        passwordField.setAttribute("type", type);
        togglePassword.src = type === "password" ? showIcon : hideIcon;
      });


      const drankjes = {
        "Primus": { prijs: 4.00, count: 0, img: "https://images.ctfassets.net/vlb1ben6vtp9/5AoH7vuMfekY2Mmqs2qQKS/33964e553c07c9c991013f553148c280/Primus_Woordmerk_rood.JPG" },
        "Mystic": { prijs: 4.00, count: 0, img: "https://assets.untappd.com/site/beer_logos_hd/beer-89870_86e4d_hd.jpeg" },
        "Stella 0.0": { prijs: 3.30, count: 0, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTB5kLCfZeQhV-a_6nBgljv48kNYvErRlo0Wg&s" },
        "Cava of Wijn": { prijs: 5.00, count: 0, img: "https://www.wijnenjacobs.be/wp-content/uploads/2023/07/Cava-Pupitre.png" },
        "Plat water": { prijs: 3.30, count: 0, img: "https://diest-pack.be/wp-content/uploads/2024/05/000675.jpg" },
        "Bruisend water": { prijs: 3.30, count: 0, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqRh8DodqftblxijHwvh6-wRWEPcWiQvaQlw&s" },
        "Cola": { prijs: 3.30, count: 0, img: "https://www.picknsave.com/content/v2/binary/image/brand/coca-cola/imageset/65265_bp_icon_cocacola_m--65265_bp_icon_coca-cola_m.png" },
        "Cola Zero": { prijs: 3.30, count: 0, img: "https://www.picknsave.com/content/v2/binary/image/brand/coca-cola/imageset_coke-zero-logo--brandicon_cokezero.png" },
        "Fanta": { prijs: 3.30, count: 0, img: "https://www.picknsave.com/content/v2/binary/image/brand/coca-cola/imageset/65265_bp_icon_fanta_m--65265_bp_icon_fanta_m.png" },
        "Fuzetea": { prijs: 3.30, count: 0, img: "https://www.franceconfiserie.com/wp-content/uploads/2022/04/logo-fuzetea-france-confiserie.jpg" },
        "Chips": { prijs: 3.30, count: 0, img: "https://raja.scene7.com/is/image/Raja/products/lay-paquet-chips-nature-lot-20-sachets-45-g_86365-00J.jpg?template=withpicto600&$image=ofr7719972BA&$picto=NoPicto&hei=600&wid=600&fmt=jpg&qlt=85,0&resMode=sharp2&op_usm=1.75,0.3,2,0" },
        "Cup Refund": { prijs: -0.70, count: 0, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHioty0iBxu1yOhmz3s8_wy_u6ChVr60-1LQ&s" }
      };

      function updateTotaal() {
        let totaal = 0;
        for (let naam in drankjes) {
          totaal += drankjes[naam].prijs * drankjes[naam].count;
        }
        document.getElementById("totaal").innerText = "Totaal: â‚¬" + totaal.toFixed(2).replace('.', ',');
      }

      function updateOverzicht() {
        const overzicht = document.getElementById("overzicht");
        overzicht.innerHTML = "";

        let ietsGekozen = false;

        for (let naam in drankjes) {
          const drankje = drankjes[naam];
          if (drankje.count > 0) {
            ietsGekozen = true;

            const item = document.createElement("div");
            item.className = "overzicht-item";

            item.innerHTML = `
              <span>${drankje.count}x ${naam}</span>
              <div class="knoppen">
                <button class="knop plus" onclick="voegToe('${naam}', 3)">+3</button>
                <button class="knop min" onclick="verwijder('${naam}')">-1</button>
                <button class="knop delete" onclick="verwijderAlles('${naam}')">x</button>
              </div>
            `;

            overzicht.appendChild(item);
          }
        }

        if (!ietsGekozen) {
          overzicht.innerText = "Nog niets geselecteerd.";
        }
      }

      function voegToe(naam, aantal = 1) {
        if (naam === "Cup Refund") {
          const maxBekers = drankjes["Primus"].count + drankjes["Mystic"].count + drankjes["Cava of Wijn"].count;
          if (drankjes["Cup Refund"].count + aantal > maxBekers) {
            alert("Extra bekers via refund-ticket.");
            return;
          }
        }

        drankjes[naam].count += aantal;
        updateTotaal();
        updateOverzicht();
      }

      function verwijder(naam) {
      if (drankjes[naam].count > 0) {
        drankjes[naam].count--;

        // Refund check beker
        if (["Primus", "Mystic", "Cava of Wijn"].includes(naam)) {
          const maxRefunds = drankjes["Primus"].count + drankjes["Mystic"].count + drankjes["Cava of Wijn"].count;
          if (drankjes["Cup Refund"].count > maxRefunds) {
            drankjes["Cup Refund"].count = maxRefunds;
          }
        }

        updateTotaal();
        updateOverzicht();
        }
      }

      function verwijderAlles(naam) {
        const removedCount = drankjes[naam].count;
        drankjes[naam].count = 0;

        // Als het een alcoholisch drankje is, pas refunds aan
        if (["Primus", "Mystic", "Cava of Wijn"].includes(naam) && removedCount > 0) {
          const maxRefunds = drankjes["Primus"].count + drankjes["Mystic"].count + drankjes["Cava of Wijn"].count;
          if (drankjes["Cup Refund"].count > maxRefunds) {
            drankjes["Cup Refund"].count = maxRefunds;
          }
        }

        // Als je Cup Refund zelf verwijdert, gewoon count op 0
        updateTotaal();
        updateOverzicht();
      }
    
      function resetAlles() {
        for (let naam in drankjes) {
          drankjes[naam].count = 0;
        }
        updateTotaal();
        updateOverzicht();
      }

      let ontvangen = 0;
      let cashTotaal = 0;

      function berekenTotaal() {
        let totaal = 0;
        for (let naam in drankjes) {
          totaal += drankjes[naam].prijs * drankjes[naam].count;
        }
        return totaal;
      }

      function toonKaart() {
        totaal = berekenTotaal();

        if (totaal <= 0) {
          alert("Nog niets geselecteerd om te betalen!");
          return;
        }

        document.getElementById("kaart-overlay").style.display = "flex";
      }

      // Functie voor terminalkeuze (voorlopig niets)
      function chooseTerminal(terminal) {
        console.log("Gekozen terminal:", terminal);
        // hier kan later verdere logica komen
      }

      // Sluiten van overlay
      document.getElementById("close-kaart").onclick = function() {
        document.getElementById("kaart-overlay").style.display = "none";
      };

      // Klik op de kaart-knop om overlay te tonen
      document.getElementById("kaart-knop").onclick = function() {
        toonKaart();
      };

      function toonQR() {
        totaal = berekenTotaal();

        if (totaal <= 0) {
          alert("Nog niets geselecteerd om te betalen!");
          return;
        }
    
        // Update bedrag in overlay
        const bedragElement = document.getElementById("qr-bedrag");
        bedragElement.innerText = "â‚¬" + totaal.toFixed(2).replace('.', ',');

        const bedragInCenten = Math.round(totaal * 100);

        // âš ï¸ Vervang '123456789' door je echte merchant ID
        const link = `https://payconiq.com/pay?to=123456789&amount=${bedragInCenten}&description=Bestelling`;

        // QR overlay zichtbaar maken
        const overlay = document.getElementById("qr-overlay");
        overlay.style.display = "flex";

        // QR-code in canvas tekenen
        const canvas = document.getElementById("qrcode");
        QRCode.toCanvas(canvas, link, { width: 250 }, function (error) {
          if (error) console.error(error);
        });
      }

      // Sluiten van overlay
      document.getElementById("close-qr").onclick = function() {
        document.getElementById("qr-overlay").style.display = "none";
      };

      function afrondenQR() {
        document.getElementById("qr-overlay").style.display = "none";
        paymentMethod = "QR-code";
        verzendBestelling();
      }
    

      function toonCash() {
        ontvangen = 0;
        totaal = berekenTotaal();

        if (totaal <= 0) {
          alert("Nog niets geselecteerd om te betalen!");
          return;
        }

        // Bouw overzicht opnieuw ZONDER knoppen
        const cashOverzicht = document.getElementById("cash-overzicht");
        cashOverzicht.innerHTML = "";

        for (let naam in drankjes) {
          const drankje = drankjes[naam];
          if (drankje.count > 0) {
            const div = document.createElement("div");
            div.textContent = `${drankje.count}x ${naam}`;
            cashOverzicht.appendChild(div);
          }
        }

        document.getElementById("cash-totaal").innerText =
          "Totaal te betalen: â‚¬" + totaal.toFixed(2).replace('.', ',');

        document.getElementById("ontvangen").innerText = "Ontvangen: â‚¬0,00";
        document.getElementById("terug").innerText = "Terug te geven: â‚¬0,00";
        document.getElementById("cash-overlay").style.display = "flex";
      }

      function addCash(bedrag) {
        ontvangen += bedrag;
        document.getElementById("ontvangen").innerText = "Ontvangen: â‚¬" + ontvangen.toFixed(2);
        let terug = ontvangen - totaal;
        document.getElementById("terug").innerText = "Terug te geven: â‚¬" + (terug > 0 ? terug.toFixed(2) : "0,00");
      }
      function resetCash() {
        ontvangen = 0; // resetten tot 0
        document.getElementById("ontvangen").innerText = "Ontvangen: â‚¬" + ontvangen.toFixed(2);
        document.getElementById("terug").innerText = "Terug te geven: â‚¬0,00";
      }
      function exactCash() {
        ontvangen = totaal; // meteen gelijk aan totaal
        document.getElementById("ontvangen").innerText = "Ontvangen: â‚¬" + ontvangen.toFixed(2);
        document.getElementById("terug").innerText = "Terug te geven: â‚¬0,00";
      }
      function afrondenCash() {
        if (ontvangen < totaal) {
          alert("Niet genoeg ontvangen!");
          return;
        }
        document.getElementById("cash-overlay").style.display = "none";
        paymentMethod = "Cash";
        verzendBestelling(); // hier stuur je naar de spreadsheet
      }

      // Sluiten van overlay
      document.getElementById("close-cash").onclick = function() {
        document.getElementById("cash-overlay").style.display = "none";
      };


      // âœ… Verzenden met FormData
      function verzendBestelling() {
        let totaal = 0;
        let items = [];

        for (let naam in drankjes) {
          if (drankjes[naam].count > 0) {
            let prijs = drankjes[naam].prijs;
            let aantal = drankjes[naam].count;
            let subtotaal = prijs * aantal;
            totaal += subtotaal;

            items.push({ naam, aantal, prijs, subtotaal });
          }
        }

        if (items.length === 0) {
          alert("Geen bestelling geselecteerd!");
          return;
        }
        
        let form = new FormData();
          form.append("items", JSON.stringify(items));
          form.append("totaal", totaal);
          form.append("barman", currentBarman);
          form.append("paymentmethod", paymentMethod);

        // ðŸ”¹ Reset direct zodat gebruiker meteen verder kan
        resetAlles();

        // ðŸ”¹ Daarna pas verzenden
        fetch("https://script.google.com/macros/s/AKfycbzysMFfKKvDEq6sdjHC0oZcAGDwla0UCZWuVwLLm-hFU9JFkBzctkIEy7NmMwuD5iFcPw/exec", {
          method: "POST",
          body: form
        })
        .then(res => res.text())
        .then(text => {
          console.log("Response:", text);

          // âœ… Vinkje tonen
          const popup = document.getElementById("check-popup");
          popup.classList.add("show");

          // Na 2s weer verbergen
          setTimeout(() => {
          popup.classList.remove("show");
          }, 1000);
        })
        .catch(err => {
        console.error("Error:", err);
        alert("Er ging iets mis bij het verzenden.");
      });
    }

    // âœ… Drankknoppen toevoegen
    const container = document.getElementById("drank-container");
    for (let naam in drankjes) {
      const drankje = drankjes[naam];
      const div = document.createElement("div");
      div.className = "drank";
      div.innerHTML = `
        <img src="${drankje.img}" alt="${naam}">
        <p>${naam} (â‚¬${drankje.prijs.toFixed(2).replace('.', ',')})</p>
      `;
      div.addEventListener('click', () => voegToe(naam));
      container.appendChild(div);
    }

  updateOverzicht();
</script>
</body>
</html>
